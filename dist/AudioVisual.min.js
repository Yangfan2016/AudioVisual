!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var i=e();for(var n in i)("object"==typeof exports?exports:t)[n]=i[n]}}(window,function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,i),a.l=!0,a.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(n,a,function(e){return t[e]}.bind(null,a));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="./dist/",i(i.s=0)}([function(t,e,i){"use strict";i.r(e),i.d(e,"AudioVisual",function(){return n});class n{constructor(t,e,i){this.RAF_ID=0,this.colorKey={},this.audioFile=i.fileElement,this.audioElement=t,this.canvasElement=e,this.config=Object.assign({},{isAutoRun:!0,thickness:1024,hightRate:2,colorStops:["#2653f7","#26daf7","#26f736","#b0f726","#f78726","#db1b12"]},i),this.state="loading",this.animateState="stop",this.audioContext=new AudioContext,this.sourceNode=this.audioContext.createMediaElementSource(this.audioElement),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=this.config.thickness,this.freqByteData=new Uint8Array(this.analyser.frequencyBinCount),this.sourceNode.connect(this.analyser),this.analyser.connect(this.audioContext.destination),this.onRunning(),this.canvasContext=this.canvasElement.getContext("2d"),this.canvasElement.width=window.outerWidth,this.canvasElement.height=window.outerHeight,this.canvasContext.strokeStyle="#fff",this.canvasContext.rotate(Math.PI),this.canvasContext.translate(0,-this.canvasElement.height),this.canvasContext.scale(-1,1),this.canvasContext.beginPath(),this.canvasContext.moveTo(0,128),this.canvasContext.lineTo(this.canvasElement.width,128),this.canvasContext.stroke(),this.canvasContext.closePath(),this.gradient=null,this.lw=10,this.makeColorStop(),this.audioFile&&this.onFileChange()}onRunning(){this.audioElement.addEventListener("play",t=>{this.state="playing",this.config.isAutoRun&&"start"!=this.animateState&&this.startDance()}),this.audioElement.addEventListener("pause",t=>{this.state="paused",this.config.isAutoRun&&this.stopDance()})}onFileChange(){this.audioFile&&this.audioFile.addEventListener("change",t=>{let e=t.target.files[0],i=new FileReader;this.state="paused",i.addEventListener("load",t=>{let e=t.target.result;this.state="playing",this.clearCanvas(),this.audioElement.src=e,this.config.isAutoRun&&(t=>{this.audioElement.play(),this.startDance()})()}),i.readAsDataURL(e)})}clearCanvas(){this.canvasContext.clearRect(0,0,this.canvasElement.width,this.canvasElement.height)}drawSLine(t){this.clearCanvas(),this.canvasContext.save(),this.canvasContext.beginPath(),this.canvasContext.moveTo(0,0);let e=this.config.hightRate;t.forEach((t,i)=>{this.gradient=this.canvasContext.createLinearGradient(i*(this.lw+1),0,i*(this.lw+1),t);for(let t in this.colorKey)this.gradient.addColorStop(+t,this.colorKey[t]);this.canvasContext.fillStyle=this.gradient,this.canvasContext.fillRect(i*(this.lw+1),0,this.lw,t*e)}),this.canvasContext.closePath(),this.canvasContext.beginPath(),this.canvasContext.moveTo(0,128),this.canvasContext.lineTo(this.canvasElement.width,128),this.canvasContext.stroke(),this.canvasContext.closePath(),this.canvasContext.restore()}animate(){this.analyser.getByteFrequencyData(this.freqByteData),this.drawSLine(this.freqByteData),requestAnimationFrame(this.animate.bind(this))}makeColorStop(){let t=this.config.colorStops,e=t.length,i=+(1/(e-1)).toFixed(1),n={};for(let a=0;a<e;a++)n[i*a]=t[a];this.colorKey=n}stopDance(t=(()=>{})){this.animateState="stop",clearTimeout(this.TIMEOUT_ID),this.TIMEOUT_ID=setTimeout(e=>{cancelAnimationFrame(this.RAF_ID),this.clearCanvas(),t&&t()},1500)}startDance(){clearTimeout(this.TIMEOUT_ID),cancelAnimationFrame(this.RAF_ID),this.animateState="start",this.RAF_ID=requestAnimationFrame(this.animate.bind(this))}}}])});