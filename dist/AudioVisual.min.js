!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var a in n)("object"==typeof exports?exports:t)[a]=n[a]}}(window,function(){return function(t){var e={};function n(a){if(e[a])return e[a].exports;var i=e[a]={i:a,l:!1,exports:{}};return t[a].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(a,i,function(e){return t[e]}.bind(null,i));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="./dist/",n(n.s=0)}([function(t,e,n){var a,i,o;i=[e],void 0===(o="function"==typeof(a=function(t){"use strict";function e(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}Object.defineProperty(t,"__esModule",{value:!0}),t.AudioVisual=void 0;var n=function(){function t(e,n,a,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.audioFile=e,this.audioElement=n,this.canvasElement=a,this.config=Object.assign(i||{},{isAutoRun:!0,isVibrating:!1,thickness:1024}),this.state="loading",this.__animateState="stop",this.vibrateArr=[0,0],this.audioContext=new window.AudioContext,this.sourceNode=this.audioContext.createMediaElementSource(this.audioElement),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=this.config.thickness,this.freqByteData=new Uint8Array(this.analyser.frequencyBinCount),this.sourceNode.connect(this.analyser),this.analyser.connect(this.audioContext.destination),this.__onRunning(),this.canvasContext=this.canvasElement.getContext("2d"),this.canvasElement.width=window.outerWidth,this.canvasElement.height=window.outerHeight,this.canvasContext.strokeStyle="#fff",this.canvasContext.rotate(Math.PI),this.canvasContext.translate(0,-this.canvasElement.height),this.canvasContext.scale(-1,1),this.canvasContext.beginPath(),this.canvasContext.moveTo(0,128),this.canvasContext.lineTo(this.canvasElement.width,128),this.canvasContext.stroke(),this.canvasContext.closePath(),this.gradient=null,this.lw=10,navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate,this.__onFileChange()}return function(t,n,a){n&&e(t.prototype,n),a&&e(t,a)}(t,[{key:"__onRunning",value:function(){var t=this;this.audioElement.addEventListener("play",function(e){t.state="playing",t.config.isAutoRun&&"start"!=t.__animateState&&t.startDance()}),this.audioElement.addEventListener("pause",function(e){t.state="paused",t.config.isAutoRun&&t.stopDance()})}},{key:"__onFileChange",value:function(){var t=this;this.audioFile.addEventListener("change",function(e){var n=e.target.files[0],a=new FileReader;t.state="paused",a.addEventListener("load",function(e){var n=e.target.result;t.state="playing",t.__clearCanvas(),t.audioElement.src=n,t.config.isAutoRun&&(t.audioElement.play(),t.startDance())}),a.readAsDataURL(n)})}},{key:"__clearCanvas",value:function(){this.canvasContext.clearRect(0,0,this.canvasElement.width,this.canvasElement.height)}},{key:"__drawSLine",value:function(t){var e=this;this.__clearCanvas(),this.canvasContext.save(),this.canvasContext.beginPath(),this.canvasContext.moveTo(0,0),t.forEach(function(t,n){e.gradient=e.canvasContext.createLinearGradient(n*(e.lw+1),0,n*(e.lw+1),t),e.gradient.addColorStop(0,"#ffff00"),e.gradient.addColorStop(.2,"#ffd400"),e.gradient.addColorStop(.4,"#ffaa00"),e.gradient.addColorStop(.6,"#ff7f00"),e.gradient.addColorStop(.8,"#ff5500"),e.gradient.addColorStop(1,"#ff2a00"),e.canvasContext.fillStyle=e.gradient,e.canvasContext.fillRect(n*(e.lw+1),0,e.lw,t)}),this.canvasContext.closePath(),this.canvasContext.beginPath(),this.canvasContext.moveTo(0,128),this.canvasContext.lineTo(this.canvasElement.width,128),this.canvasContext.stroke(),this.canvasContext.closePath(),this.canvasContext.restore()}},{key:"__animate",value:function(){var t=this;this.analyser.getByteFrequencyData(this.freqByteData),this.__drawSLine(this.freqByteData),this.config.isVibrating&&(t.vibrateArr=t.freqByteData.filter(function(t,e){return t>10&&t<200}),t.vibrateArr=[Math.max.apply(null,t.vibrateArr),Math.min.apply(null,t.vibrateArr)],navigator.vibrate(t.vibrateArr[0]))}},{key:"stopDance",value:function(t){var e=this;this.__animateState="stop",clearTimeout(this.__TIMEOUT_ID),this.__TIMEOUT_ID=setTimeout(function(n){clearInterval(e.__INTERVAL_ID),e.__clearCanvas(),t&&t()},1500),this.config.isVibrating&&navigator.vibrate(0)}},{key:"startDance",value:function(){clearTimeout(this.__TIMEOUT_ID),clearInterval(this.__INTERVAL_ID),this.__animateState="start",this.__INTERVAL_ID=setInterval(this.__animate.bind(this),this.vibrateArr[1])}}]),t}();t.AudioVisual=n})?a.apply(e,i):a)||(t.exports=o)}])});